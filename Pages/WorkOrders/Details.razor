
@page "/workorders/details/{Id:int}"
@inject IWorkOrdersService Service

<h1>Job Details</h1>

@if (Job is null)
{
    <p>Loading...</p>
}
else
{
    <div class="card">
        <h3>@Job.JobName</h3>
        <p><b>Client:</b> @Job.ClientName</p>
        <p><b>Quantity:</b> @Job.Quantity</p>
        <p><b>Carrier:</b> @Job.Carrier</p>
        <p><b>Status:</b> <span class="badge @GetBadge(Job.CurrentStatus)">@Job.CurrentStatus</span></p>
        <p><b>Created:</b> @Job.CreatedAt.ToLocalTime()</p>
        <p><b>SLA Mail By:</b> @Job.SLA_MailBy.ToLocalTime().ToShortDateString()</p>
    </div>

    <h3>Status History</h3>
    <table class="table">
        <thead>
            <tr><th>When</th><th>Status</th><th>Note</th></tr>
        </thead>
        <tbody>
        @foreach (var h in Job.History.OrderBy(h => h.ChangedAt))
        {
            <tr>
                <td>@h.ChangedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                <td>@h.Status</td>
                <td>@h.Note</td>
            </tr>
        }
        </tbody>
    </table>
}

@code {
    [Parameter] public int Id { get; set; }
    private PrintingJobTracker.Domain.Job? Job;

    protected override async Task OnParametersSetAsync()
    {
        Job = await Service.GetJobAsync(Id);
    }

    string GetBadge(JobStatus s) => s switch
    {
        JobStatus.Received => "badge-received",
        JobStatus.Printing => "badge-printing",
        JobStatus.Inserting => "badge-inserting",
        JobStatus.Mailed => "badge-mailed",
        JobStatus.Delivered => "badge-delivered",
        JobStatus.Exception => "badge-exception",
        _ => ""
    };
}
