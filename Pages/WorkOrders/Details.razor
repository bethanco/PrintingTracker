@using System.Linq
@using PrintingJobTracker.Shared
@using Microsoft.AspNetCore.Components.Forms
@using PrintingJobTracker.Services
@using PrintingJobTracker.Models
@page "/workorders/{id:int}"
@inject PrintingJobTracker.Services.IWorkOrdersService Service

<h2>Job Details</h2>

@if (_item is null)
{
  <p>Loading...</p>
}
else
{
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">@_item.ClientName â€” @_item.JobName</h5>
      <p class="card-text">Quantity: @_item.Quantity | Carrier: @_item.Carrier</p>
      <p class="card-text">CurrentStatus: <span class="badge bg-secondary">@_item.CurrentStatus</span></p>
      <p class="card-text"><small class="text-muted">CreatedAt: @_item.CreatedAt.ToLocalTime()</small></p>
    </div>
  </div>

  <h5>StatusHistory</h5>
  @if (_item.StatusHistory?.Count == 0)
  {
    <p>No history.</p>
  }
  else
  {
    <ul class="list-group">
      @foreach (var h in _item.StatusHistory?.OrderByDescending(x => x.ChangedAt))
      {
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>@h.Status</span>
          <span class="text-muted">@h.ChangedAt.ToLocalTime()</span>
        </li>
      }
    </ul>
  }
}

@code {
  [Parameter] public int id { get; set; }
  private Job? _item;

  protected override async Task OnParametersSetAsync()
  {
      _item = await Service.GetJobAsync(id);
  }
}